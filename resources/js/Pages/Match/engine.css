/* ==========================================================================
   ENGINE MIN CSS (garde uniquement ce qui n'est pas clean en Tailwind)
   ========================================================================== */

/* --- helper: cacher sans dépendre de tailwind quand le JS toggle --- */
#game-wrapper .hidden,
#game-wrapper [hidden] { display: none !important; }

#game-wrapper .visually-hidden {
    border: 0;
    clip: rect(0, 0, 0, 0);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    white-space: nowrap;
    width: 1px;
}

/* ==========================================================================
   TERRAIN
   (gardé en CSS car gradient long + ratio + plein d'éléments positionnés)
   ========================================================================== */

#field-wrapper { position: relative; }

#field {
    width: 100%;
    padding-top: 60%;
    position: relative;
    border-radius: 16px;
    overflow: hidden;

    background: linear-gradient(
        90deg,
        #2f7b28 0%,
        #2f7b28 15%,
        #34852e 15%,
        #34852e 30%,
        #2f7b28 30%,
        #2f7b28 50%,
        #34852e 50%,
        #34852e 70%,
        #2f7b28 70%,
        #2f7b28 85%,
        #34852e 85%,
        #34852e 100%
    );

    box-shadow:
        0 15px 26px rgba(0,0,0,0.45),
        0 0 0 4px #fdfdfd inset;
}

/* Overlay IA (JS toggle .visible) */
#ai-turn-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.18);
    color: #fff;
    font-size: 14px;
    font-weight: 600;
    text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    z-index: 10;
}
#ai-turn-overlay.visible { opacity: 1; }

/* Lignes / formes terrain */
.pitch-line {
    position: absolute;
    border: 2px solid rgba(245,245,245,0.95);
    pointer-events: none;
}
#border-rect { left: 3%; top: 3%; right: 3%; bottom: 3%; }
#halfway-line { left: 50%; top: 3%; bottom: 3%; border-left-width: 2px; border-right: none; }

#center-circle {
    position: absolute;
    left: 50%; top: 50%;
    width: 18%; height: 36%;
    border-radius: 50%;
    border: 2px solid rgba(245,245,245,0.95);
    transform: translate(-50%, -50%);
    pointer-events: none;
}

.penalty-box {
    position: absolute;
    top: 20%;
    width: 18%;
    height: 60%;
    border: 2px solid rgba(245,245,245,0.95);
    pointer-events: none;
}
#penalty-left { left: 3%; }
#penalty-right { right: 3%; }

.goal-area {
    position: absolute;
    top: 32%;
    width: 8%;
    height: 36%;
    border: 2px solid rgba(245,245,245,0.95);
    pointer-events: none;
}
#goal-area-left { left: 3%; }
#goal-area-right { right: 3%; }

.spot {
    position: absolute;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #fefefe;
    box-shadow: 0 0 4px rgba(0,0,0,0.5);
}
#center-spot { left: 50%; top: 50%; transform: translate(-50%,-50%); }
#pen-spot-left { left: 13%; top: 50%; transform: translate(-50%,-50%); }
#pen-spot-right { right: 13%; top: 50%; transform: translate(50%,-50%); }

.goal {
    position: absolute;
    width: 10px;
    height: 30%;
    background: #8c8c8c;
    top: 35%;
    box-shadow: 0 3px 5px rgba(0,0,0,0.4), 0 0 0 2px #f9f9f9 inset;
}
#goal-left { left: -3px; }
#goal-right { right: -3px; }

/* ==========================================================================
   PIONS + BALLON (gardé car easing custom + styles internal/external)
   ========================================================================== */

.player {
    position: absolute;
    width: 35px;
    height: 35px;
    border-radius: 999px;
    border: 2px solid #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 700;
    transform: translate(-50%, -50%);
    text-shadow: 0 0 3px rgba(0,0,0,0.6);
    transition:
        left 0.70s cubic-bezier(0.22, 0.61, 0.36, 1),
        top  0.70s cubic-bezier(0.22, 0.61, 0.36, 1),
        box-shadow 0.20s;
}

/* thèmes équipe */
.player.internal {
    background: radial-gradient(circle at 30% 30%, #8ad0ff 0, #0074ff 70%);
    box-shadow: 0 3px 6px rgba(0,0,0,0.45);
}
.player.external {
    background: radial-gradient(circle at 30% 30%, #ffd19a 0, #ff7f35 70%);
    box-shadow: 0 3px 6px rgba(0,0,0,0.45);
}
.player.goalkeeper {
    box-shadow: 0 0 8px rgba(255,255,0,0.9), 0 3px 6px rgba(0,0,0,0.55);
}

/* mini endurance sur pion (JS toggle .show-endurance) */
.player .endurance-shell {
    position: absolute;
    left: 50%;
    bottom: -5px;
    transform: translateX(-50%);
    width: 70%;
    height: 4px;
    border-radius: 999px;
    background: rgba(0,0,0,0.35);
    overflow: hidden;
    opacity: 0;
    transition: opacity 0.2s ease;
}
.player.show-endurance .endurance-shell { opacity: 1; }
.player .endurance-bar { height: 100%; width: 100%; border-radius: inherit; background: #4de074; }

.player.e-high { filter: none; }
.player.e-mid  { filter: brightness(1.05) saturate(1.1); }
.player.e-low  { filter: brightness(0.95) saturate(1.2); }
.player.e-crit { filter: brightness(0.9) saturate(1.4); }

/* Ballon */
#ball {
    position: absolute;
    width: 20px;
    height: 20px;
    border-radius: 999px;
    background: radial-gradient(circle at 30% 30%, #ffffff 0, #f0e6b5 40%, #d1c56a 100%);
    border: 2px solid rgba(115,105,35,0.8);
    transform: translate(-50%, -50%);
    box-shadow: 0 4px 8px rgba(0,0,0,0.6);
    z-index: 5;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    text-shadow: 0 0 2px rgba(0,0,0,0.8);
    transition:
        left 0.70s cubic-bezier(0.22, 0.61, 0.36, 1),
        top  0.70s cubic-bezier(0.22, 0.61, 0.36, 1),
        transform 0.15s ease-out;
}
.ball-kick { transform: translate(-50%, -52%) scale(1.05); }

/* Indicateur tour */
#turn-indicator {
    position: absolute;
    right: 10px;
    bottom: -32px;
    width: 30px;
    height: 30px;
    background: #000;
    color: #fff;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-variant-numeric: tabular-nums;
    box-shadow: 0 2px 4px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.4) inset;
}

/* ==========================================================================
   ETATS / ANIMATIONS JS (dice / action-bar / energy)
   ========================================================================== */

/* Chip duel (JS toggle .visible + .pop) */
.dice-chip {
    font-size: 10px;
    padding: 2px 8px;
    border-radius: 999px;
    background: rgba(0,0,0,0.06);
    color: #222;
    font-variant-numeric: tabular-nums;

    opacity: 0;
    transform: scale(0.8);
    transition: opacity 0.25s ease, transform 0.25s ease;
    white-space: nowrap;

    cursor: help;                 /* ✅ indique tooltip */
    position: relative;           /* ✅ safe */
}
.dice-chip:focus {
    outline: 2px solid rgba(59,130,246,0.85);
    outline-offset: 2px;
}
.dice-chip.visible { opacity: 1; transform: scale(1); }
.dice-chip.pop { animation: dice-pop 0.45s ease-out; }
@keyframes dice-pop {
    0% { transform: scale(0.8); }
    40% { transform: scale(1.1); }
    100% { transform: scale(1); }
}
/* ==========================================================================
   TOOLTIP duel (calcul complet)
   ========================================================================== */
.dice-tooltip{
    max-width: min(420px, calc(100vw - 24px));
}
/* Par défaut, flèche vers le haut (tooltip en dessous du dé) */
.dice-tooltip::after{
    /* ton style actuel de flèche... */
}

/* ✅ Si tooltip au-dessus du dé, on inverse la flèche */
.dice-tooltip[data-placement="top"]::after{
    /* exemple si ta flèche est un triangle CSS :
       - inverse border-top/border-bottom
       - et positionne la flèche en bas du tooltip
    */
    top: auto;
    bottom: -8px;
    transform: rotate(180deg);
}


#duel-dice-tooltip {
    position: absolute;
    z-index: 9999;
    width: 360px;


    /* le JS place left/top près de la chip,
       et on remonte un peu au-dessus */
    transform: translateY(-100%);
    margin-top: -10px;

    background: linear-gradient(
        to bottom,
        rgba(71, 85, 105, 0.95) 0%,
        rgba(51, 65, 85, 0.95) 40%,
        rgba(33, 45, 65, 0.95) 100%
    );
    color: rgba(226, 232, 240, 0.95);

    border: 1px solid rgba(148, 163, 184, 0.22);
    border-radius: 14px;

    padding: 10px 12px;

    box-shadow:
        0 18px 34px rgba(0,0,0,0.42),
        0 0 0 1px rgba(255,255,255,0.04) inset;

    font-size: 12px;
    line-height: 1.35;

    pointer-events: none; /* ✅ évite le flicker au hover */
}

#duel-dice-tooltip.hidden { display: none !important; }

#duel-dice-tooltip .dt-title {
    font-weight: 900;
    color: #fff;
    margin: 6px 0 6px;
    letter-spacing: 0.2px;
}

#duel-dice-tooltip .dt-section + .dt-section { margin-top: 10px; }

#duel-dice-tooltip .dt-row {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 12px;

    padding: 2px 0;
    border-bottom: 1px dashed rgba(148, 163, 184, 0.14);
}
#duel-dice-tooltip .dt-row:last-child { border-bottom: none; }

#duel-dice-tooltip .dt-label { opacity: 0.85; }
#duel-dice-tooltip .dt-value {
    font-weight: 800;
    color: rgba(241, 245, 249, 0.95);
    font-variant-numeric: tabular-nums;
}


/* Action bar switch (JS toggle fade-in/out) */
#action-bar.fade-out { opacity: 0; transform: translateY(8px); pointer-events: none; }
#action-bar.fade-in  { opacity: 1; transform: translateY(0); pointer-events: auto; }

#home-energy-fill,
#away-energy-fill {
    display: block;
    height: 100%;
    width: 100%;
    transition: width 0.3s ease, background 0.25s ease;
}

/* états */
#home-energy-fill.e-high,
#away-energy-fill.e-high {
    background: linear-gradient(90deg, #38b000, #9ef01a);
}
#home-energy-fill.e-mid,
#away-energy-fill.e-mid {
    background: linear-gradient(90deg, #f2c94c, #f2994a);
}
#home-energy-fill.e-low,
#away-energy-fill.e-low {
    background: linear-gradient(90deg, #ff8e53, #ff3d00);
}
#home-energy-fill.e-crit,
#away-energy-fill.e-crit {
    background: linear-gradient(90deg, #ff1744, #d50000);
}

/* ==========================================================================
   ACTION BAR (cards) — nécessaire car HTML injecté par engine.js
   ========================================================================== */

#bars-container {
    margin-top: 30px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

/* zone qui contient les cartes */
#action-bar {
    display: block;
    width: 100%;
    margin: 0 auto;
    border-radius: 16px;
    padding: 12px;
    background: rgba(255,255,255,0.85);
    box-shadow: 0 12px 22px rgba(0,0,0,0.18);
    border: 1px solid rgba(0,0,0,0.06);
}

/* strips */
#attack-strip,
#defense-strip {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 12px;
    align-items: stretch;
}

/* GK strip (3 cartes) */
#defense-strip:has(.def-card[data-defense="hands"]),
#defense-strip:has(.def-card[data-defense="punch"]) {
    grid-template-columns: repeat(3, minmax(0, 1fr));
}

/* responsive */
@media (max-width: 900px) {
    #attack-strip,
    #defense-strip {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }
}

/* ==========================================================================
   THEMES selon le mode (engine.js met mode-attack-* / mode-defense-*)
   ========================================================================== */

/* attaque internal */
#action-bar.mode-attack-internal .skill-card {
    background: linear-gradient(180deg, rgba(239,246,255,0.95), rgba(255,255,255,0.92));
    border-color: rgba(59,130,246,0.18);
}

/* attaque external */
#action-bar.mode-attack-external .skill-card {
    background: linear-gradient(180deg, rgba(255,247,237,0.95), rgba(255,255,255,0.92));
    border-color: rgba(249,115,22,0.18);
}

/* defense internal */
#action-bar.mode-defense-internal .def-card {
    background: linear-gradient(180deg, rgba(240,253,244,0.95), rgba(255,255,255,0.92));
    border-color: rgba(34,197,94,0.16);
}

/* defense external */
#action-bar.mode-defense-external .def-card {
    background: linear-gradient(180deg, rgba(254,242,242,0.95), rgba(255,255,255,0.92));
    border-color: rgba(239,68,68,0.16);
}

/* ==========================================================================
   ACTION CARDS — thématisation via CSS variables (mode-*)
   ========================================================================== */

/* Base : variables par défaut (fallback) */
#action-bar {
    --card-accent-1: rgba(15, 23, 42, 0.95);
    --card-accent-2: rgba(148, 163, 184, 0.95);

    --card-border: rgba(0, 0, 0, 0.06);
    --card-inset: rgba(0, 0, 0, 0.10);
    --card-shadow: rgba(0, 0, 0, 0.16);
}

/* =========================================================
   Modes : on ne fait que setter les variables
   ========================================================= */

/* Attaque INTERNAL (bleu) */
#action-bar.mode-attack-internal {
    --card-accent-1: rgba(59, 130, 246, 0.95);
    --card-accent-2: rgba(147, 197, 253, 0.95);
    --card-border: rgba(59, 130, 246, 0.28);
    --card-inset: rgba(59, 130, 246, 0.10);
}

/* Attaque EXTERNAL (orange) */
#action-bar.mode-attack-external {
    --card-accent-1: rgba(249, 115, 22, 0.95);
    --card-accent-2: rgba(253, 186, 116, 0.95);
    --card-border: rgba(249, 115, 22, 0.28);
    --card-inset: rgba(249, 115, 22, 0.10);
}

/* Défense INTERNAL (bleu aussi chez toi actuellement) */
#action-bar.mode-defense-internal {
    --card-accent-1: rgba(59, 130, 246, 0.95);
    --card-accent-2: rgba(147, 197, 253, 0.95);
    --card-border: rgba(59, 130, 246, 0.28);
    --card-inset: rgba(59, 130, 246, 0.10);
}

/* Défense EXTERNAL (orange aussi chez toi actuellement) */
#action-bar.mode-defense-external {
    --card-accent-1: rgba(249, 115, 22, 0.95);
    --card-accent-2: rgba(253, 186, 116, 0.95);
    --card-border: rgba(249, 115, 22, 0.28);
    --card-inset: rgba(249, 115, 22, 0.10);
}

/* =========================================================
   Base cards (skill + defense) — styles communs
   ========================================================= */

.skill-card,
.def-card {
    position: relative;
    overflow: hidden;

    appearance: none;
    border: 1px solid var(--card-border);
    cursor: pointer;

    display: grid;
    grid-template-rows: auto auto auto 1fr;
    gap: 4px;

    width: 100%;
    min-height: 18px;
    padding: 12px;
    border-radius: 16px;

    background: rgba(255, 255, 255, 0.92);
    box-shadow:
        0 10px 18px var(--card-shadow),
        0 0 0 1px var(--card-inset) inset;

    transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    text-align: left;
}

/* petit bandeau couleur en haut de chaque carte */
.skill-card::before,
.def-card::before {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    height: 6px;
    opacity: 0.95;
    background: linear-gradient(90deg, var(--card-accent-1), var(--card-accent-2));
}

.skill-card:hover,
.def-card:hover {
    transform: translateY(-1px);
    box-shadow: 0 14px 22px rgba(0, 0, 0, 0.22);
}

.skill-card:active,
.def-card:active {
    transform: translateY(0);
    filter: brightness(0.98);
}

/* icon + titles */
.skill-icon,
.def-icon {
    font-size: 18px;
    line-height: 1;
}

.skill-title,
.def-title {
    font-size: 13px;
    font-weight: 800;
    color: #0f172a;
    letter-spacing: 0.2px;
}

.skill-sub,
.def-sub {
    font-size: 11px;
    color: rgba(15, 23, 42, 0.70);
}

/* bottom row (power + cost) */
.skill-bottom,
.def-bottom {
    margin-top: 6px;
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: 10px;
}

.skill-power,
.def-power {
    font-size: 18px;
    font-weight: 900;
    color: #0f172a;
    font-variant-numeric: tabular-nums;
}

.skill-cost,
.def-cost {
    font-size: 11px;
    font-weight: 700;
    color: rgba(15, 23, 42, 0.75);
    white-space: nowrap;
}

.skill-cost span,
.def-cost span {
    font-weight: 900;
    color: rgba(15, 23, 42, 0.90);
}

/* petit label info si tu l’utilises */
#info-text {
    font-size: 12px;
    color: rgba(15, 23, 42, 0.75);
}


/* ==========================================================================
   TEAM BORDER (cards home/away)
   ========================================================================== */

#home-card,
#away-card {
    position: relative;
    overflow: hidden;

    border-radius: 16px;
    border: 1px solid rgba(0, 0, 0, 0.06);

    background: rgba(255, 255, 255, 0.95);

    box-shadow:
        0 10px 18px rgba(0, 0, 0, 0.16),
        0 0 0 1px rgba(0, 0, 0, 0.10) inset;
}

/* bandeau couleur en haut (comme .skill-card::before) */
#home-card::before,
#away-card::before {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    height: 6px;
    opacity: 0.95;
}

/* ===============================
   INTERNAL (bleu)
   =============================== */

#home-card.team-internal,
#away-card.team-internal {
    --player-accent-1: rgba(59, 130, 246, 0.95);
    --player-accent-2: rgba(147, 197, 253, 0.95);
    --player-border: rgba(59, 130, 246, 0.28);
    --player-inset: rgba(59, 130, 246, 0.10);
}

#home-card.team-internal,
#away-card.team-internal {
    border-color: var(--player-border);
    box-shadow:
        0 12px 22px rgba(59, 130, 246, 0.22),
        0 0 0 1px var(--player-inset) inset;
}

#home-card.team-internal::before,
#away-card.team-internal::before {
    background: linear-gradient(
        90deg,
        var(--player-accent-1),
        var(--player-accent-2)
    );
}

/* ===============================
   EXTERNAL (orange)
   =============================== */

#home-card.team-external,
#away-card.team-external {
    --player-accent-1: rgba(249, 115, 22, 0.95);
    --player-accent-2: rgba(253, 186, 116, 0.95);
    --player-border: rgba(249, 115, 22, 0.28);
    --player-inset: rgba(249, 115, 22, 0.10);
}

#home-card.team-external,
#away-card.team-external {
    border-color: var(--player-border);
    box-shadow:
        0 12px 22px rgba(249, 115, 22, 0.22),
        0 0 0 1px var(--player-inset) inset;
}

#home-card.team-external::before,
#away-card.team-external::before {
    background: linear-gradient(
        90deg,
        var(--player-accent-1),
        var(--player-accent-2)
    );
}

/* ==========================================================================
   PLAYER CARD PHOTO LAYER
   ========================================================================== */

#home-card,
#away-card,
#defender-card {
}

.player-card-photo {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    pointer-events: none;
}
#home-portrait,
#away-portrait,
#defender-portrait {
    position: relative;
    overflow: hidden;
}

/* ==========================================================================
   MODE 1 JOUEUR — état actif
   ========================================================================== */

#mode-one-player.active {
    background: linear-gradient(
        135deg,
        #64748b, /* slate-500 */
        #475569  /* slate-600 */
    );
    color: #ffffff;

    border: 1px solid rgba(255, 255, 255, 0.3);

    box-shadow:
        0 4px 6px rgba(0, 0, 0, 0.15),       /* drop-shadow-md */
        0 0 0 1px rgba(255, 255, 255, 0.35) inset;

    transform: translateY(0); /* cohérence avec active */
}
